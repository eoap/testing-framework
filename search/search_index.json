{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Testing EO Application Packages with cwltest","text":"<p>This document provides guidance for EOAP developers on how to write, organise, and execute tests for EO Application Packages using the CWL testing framework (cwltest).</p> <p>It includes examples, recommended patterns, and practices aligned with EOAP quality and maturity requirements.</p>"},{"location":"#why-testing-matters-in-eoap","title":"Why Testing Matters in EOAP","text":"<p>EO Application Packages (EOAPs) are intended to be:</p> <ul> <li>portable</li> <li>reproducible</li> <li>shareable across computing platforms (local, cloud, HPC, Kubernetes)</li> <li>deployable as OGC API Processes</li> </ul> <p>To reach these goals, each application package should include unit tests, integration tests, and ideally end-to-end workflow tests.</p> <p>Using cwltest ensures that:</p> <ul> <li>each CWL tool behaves as expected</li> <li>the application package is deterministic when required</li> <li>refactoring does not introduce regressions</li> <li>the package remains stable across environments (e.g., cwltool, calrissian)</li> </ul> <p>EOAP maturity levels can be verified before publication or deployment</p>"},{"location":"#what-is-cwltest","title":"What is cwltest","text":"<p><code>cwltest</code> is the official testing framework for the Common Workflow Language (CWL).</p> <p>It allows validating:</p> <ul> <li>individual CWL CommandLineTool steps</li> <li>full Workflow executions</li> <li>structured outputs (files, directories, metadata)</li> <li>deterministic checksums and sizes</li> <li>expected failures (should_fail)</li> </ul> <p>Tests are defined declaratively in YAML.</p>"},{"location":"#recommended-directory-structure","title":"Recommended Directory Structure","text":"<p>Place test files inside a dedicated directory within your EOAP repository:</p> <pre><code>tests/\n    test-suite.yaml          # The complete test suite\n    inputs-01.yaml           # Job inputs for crop (green)\n    inputs-02.yaml           # Job inputs for crop (nir)\n    inputs-03.yaml           # Job inputs for NDWI\n    inputs-04.yaml           # Job inputs for Otsu\n    inputs-05.yaml           # Job inputs for STAC\n    inputs-e2e.yaml          # Job inputs for full workflow test\n</code></pre> <p>This pattern can be reused for any EOAP application package.</p>"},{"location":"#writing-test-cases","title":"Writing Test Cases","text":"<p>Each test is an entry in a YAML list with the following fields:</p> <ul> <li>id: unique-test-id   doc: \"Human-readable description\"   tool: path-or-URL-to-CWL-tool-or-workflow   job: path-to-job-inputs.yaml   output:     output_name:       class: File or Directory       location: Any or deterministic</li> </ul>"},{"location":"#recommended-naming-conventions","title":"Recommended naming conventions","text":"<p>IDs should reflect the step:</p> <p><code>crop-green</code>, <code>normalized-difference</code>, <code>otsu-threshold</code></p> <p>Full workflow tests should end with:</p> <p><code>workflow-end-to-end</code></p>"},{"location":"#examples","title":"Examples","text":""},{"location":"#example-unit-test-flexible-output","title":"Example Unit Test (Flexible Output)","text":"<p>This test validates a step (crop) that may produce large raster outputs where strict hashing is unnecessary.</p> <pre><code>- id: crop-green\n  doc: \"Unit test for the 'crop' step using the Green band input.\"\n  tool: app.cwl#crop\n  job: inputs-01.yaml\n  output:\n    cropped:\n      class: File\n      location: Any\n</code></pre>"},{"location":"#example-deterministic-test-strict-output","title":"Example Deterministic Test (Strict Output)","text":"<p>When a test must enforce full reproducibility\u2014such as the generation of STAC metadata\u2014the output can include checksums and sizes:</p> <pre><code>- id: stac-generation\n  doc: \"Unit test verifying deterministic STAC Catalog creation.\"\n  tool: app.cwl#stac\n  job: inputs-05.yaml\n  output:\n    stac_catalog:\n      class: Directory\n      listing:\n        - class: File\n          location: catalog.json\n          checksum: \"sha1$70e96cddbb205363b4ee9cb763e438a29fd29cdc\"\n          size: 363\n</code></pre> <p>This ensures reproducibility across:</p> <ul> <li>workstations</li> <li>Docker-based runners</li> <li>calrissian on Kubernetes</li> <li>future versions of the container image</li> </ul>"},{"location":"#example-integration-test-end-to-end","title":"Example Integration Test (End-to-End)","text":"<p>EOAPs require full workflow validation:</p> <pre><code>- id: workflow-end-to-end\n  doc: \"Integration test running the entire water-bodies workflow end-to-end.\"\n  tool: app.cwl\n  job: inputs-e2e.yaml\n  output:\n    stac_catalog:\n      class: Directory\n      location: Any\n</code></pre> <p>This test confirms that:</p> <ul> <li>all steps connect correctly</li> <li>output structure follows EOAP conventions</li> <li>the application can run as a service in an automated environment</li> </ul>"},{"location":"#generating-checksums-for-deterministic-tests","title":"Generating Checksums (For Deterministic Tests)","text":"<p>To produce a SHA-1 checksum for any deterministic output:</p> <p><code>sha1sum output-file.tif</code></p> <p>or for a directory listing</p> <p><code>find directory -type f -exec sha1sum {} \\;</code></p> <p>Use the result inside your test:</p> <pre><code>checksum: \"sha1$&lt;value&gt;\"\n</code></pre>"},{"location":"#running-the-test-suite","title":"Running the Test Suite","text":"<p>Install the required tools:</p> <p><code>pip install cwltool cwltest</code></p> <p>Run the suite:</p> <pre><code>cwltest --test tests/water-bodies/test-suite.yaml\n</code></pre> <p>Run only one test:</p> <pre><code>cwltest --test tests/water-bodies/test-suite.yaml --id stac-generation\n</code></pre>"},{"location":"#adding-tests-to-github-actions-ci","title":"Adding Tests to GitHub Actions CI","text":"<p>A minimal workflow:</p> <pre><code>name: cwltest\n\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - run: pip install cwltool cwltest\n      - run: cwltest --test tests/test-suite.yaml\n</code></pre> <p>This ensures EOAP packages remain validated continuously.</p>"},{"location":"#best-practices-summary","title":"Best Practices Summary","text":"<ul> <li>Use unit tests for tool fragments</li> <li>Use integration tests for workflows</li> <li>Keep test inputs small and public</li> <li>Add deterministic tests for metadata or small artifacts</li> <li>Validate directory structures for EOAP/STAC compliance</li> <li>Automate test execution using GitHub Actions</li> <li>Ensure tests run with cwltool and platform runners (e.g., calrissian)</li> </ul>"},{"location":"#conclusion","title":"Conclusion","text":"<p>Testing is an essential component of EOAP development. Using cwltest ensures your application package is:</p> <ul> <li>reliable</li> <li>reproducible</li> <li>ready for sharing</li> <li>suitable for execution in operational systems, including OGC API Processes</li> </ul>"}]}